<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Fish Target</title>
  <link rel="stylesheet" href="style.css" />
  <style>
   body {
     margin: 0;
     font-family: 'Segoe UI', sans-serif;
     background-color: white;
     display: flex;
     justify-content: center;
     align-items: center;
     height: 100vh;
     padding-top: 70px; /* to prevent topbar overlap */
     position: relative;
     overflow-x: hidden;
     flex-direction: column; /* stack content vertically */
   }

   .container {
     background: #fff;
     padding: 30px;
     border-radius: 12px;
     box-shadow: 0 4px 12px rgba(0,0,0,0.1);
     width: 90%;
     max-width: 400px;
     position: relative;
     z-index: 1;
     margin-bottom: 20px;
   }

   h1 {
     margin-bottom: 20px;
     text-align: center;
     color: #2b6cb0;
   }

   label {
     display: block;
     margin-top: 15px;
     font-weight: bold;
   }

   select,
   input {
     width: 100%;
     padding: 10px;
     margin-top: 5px;
     border: 1px solid #ccc;
     border-radius: 6px;
   }

   button {
     margin-top: 20px;
     width: 100%;
     background-color: #2b6cb0;
     color: white;
     border: none;
     padding: 12px;
     border-radius: 6px;
     cursor: pointer;
     font-weight: bold;
   }

   button:hover {
     background-color: #1e4f80;
   }

   .gear-category {
     margin: 20px 0;
     padding: 20px;
     background: #f1faff;
     border-radius: 10px;
     box-shadow: 0 2px 8px rgba(0,0,0,0.1);
   }

   .gear-category h2 {
     margin-bottom: 10px;
     color: #2b6cb0;
   }

   .gear-item {
     background: #fff;
     padding: 10px 12px;
     margin: 6px 0;
     border-left: 4px solid #2b6cb0;
     border-radius: 6px;
     font-weight: 600;
     display: flex;
     flex-direction: column;
     align-items: flex-start;
   }

   .buy-button {
     margin-top: 8px;
     width: auto;
     padding: 6px 12px;
     font-weight: 600;
     border-radius: 4px;
   }

   .suggestion-box {
     background: #eef6ff;
     border: 1px solid #2b6cb0;
     padding: 20px;
     margin-top: 20px;
     border-radius: 8px;
     white-space: pre-wrap;
     font-family: monospace;
     color: #1a365d;
   }

   .topbar {
     width: 100%;
     background-color: #2b6cb0;
     padding: 15px 0;
     text-align: center;
     color: white;
     font-size: 1.7rem;
     font-weight: 600;
     box-shadow: 0 1px 3px rgba(0,0,0,0.1);
     position: fixed;
     top: 0;
     left: 0;
     z-index: 10;
   }

   /* Hide fish animation for now */
   svg.fish {
     display: none !important;
   }

   /* Results layout */
   .results-header {
     text-align: center;
     margin: 20px 0 10px;
     color: #2b6cb0;
   }

   .results-wrapper {
     max-width: 400px;
     width: 90%;
     margin: 0 auto 30px;
     display: block;
   }
  </style>
</head>
<body>
  <!-- Fish animation SVG hidden -->
  <svg class="fish" id="fish" style="position: fixed; top: 5em; left: 0; pointer-events: none; z-index: 0;">
    <!-- (SVG paths omitted for brevity, same as original) -->
  </svg>

  <div class="topbar">ðŸŽ£ Bait & Tackle Advisor</div>

  <div class="container">
    <h1>Tell us about your hunt</h1>

    <label for="targetFish">What fish are you trying to catch?</label>
    <input
      type="text"
      id="targetFish"
      placeholder="e.g., Striped Bass"
      autocomplete="off"
    />
    <button id="submitFishBtn">Submit</button>
  </div>

  <script>
    document.addEventListener('DOMContentLoaded', () => {
      const submitBtn = document.getElementById('submitFishBtn');

      submitBtn.addEventListener('click', async () => {
        const waterType = localStorage.getItem('waterType');
        const rodType = localStorage.getItem('rodType');
        const lineStrength = localStorage.getItem('lineStrength');
        const state = localStorage.getItem('state');
        const targetFish = document.getElementById('targetFish').value.trim();

        if (!targetFish) {
          alert("Please enter the target fish.");
          return;
        }

        const container = document.querySelector('.container');
        container.remove();

        const loading = document.createElement('p');
        loading.textContent = "Getting your gear recommendations...";
        loading.style.color = '#2b6cb0';
        loading.style.textAlign = 'center';
        loading.style.marginTop = '30px';
        loading.style.fontWeight = '600';
        document.body.appendChild(loading);

        try {
          const res = await fetch('/api/suggestions', {
            method: 'POST',
            headers: { 'Content-Type': 'application/json' },
            body: JSON.stringify({ waterType, rodType, lineStrength, state, targetFish })
          });

          const data = await res.json();
          loading.remove();

          if (data.error) throw new Error(data.error);

          const suggestions = data.suggestions;

          const header = document.createElement('h2');
          header.className = 'results-header';
          header.textContent = `Hereâ€™s what we recommend for catching a ${targetFish}`;
          document.body.appendChild(header);

          const resultsWrapper = document.createElement('div');
          resultsWrapper.className = 'results-wrapper';

          Object.keys(suggestions).forEach(category => {
            const items = suggestions[category];
            if (!Array.isArray(items) || items.length === 0) return;

            const section = document.createElement('div');
            section.className = 'gear-category';

            const title = document.createElement('h2');
            title.textContent = category;
            section.appendChild(title);

            items.forEach(item => {
              const box = document.createElement('div');
              box.className = 'gear-item';
              box.textContent = item;

              const buyBtn = document.createElement('button');
              buyBtn.className = 'buy-button';
              buyBtn.textContent = 'Buy';
              buyBtn.addEventListener('click', () => {
                const searchQuery = encodeURIComponent(item);
                const url = `https://www.amazon.com/s?k=${searchQuery}&tag=clamtour-20`;
                window.open(url, '_blank');
              });

              box.appendChild(document.createElement('br'));
              box.appendChild(buyBtn);
              section.appendChild(box);
            });

            resultsWrapper.appendChild(section);
          });

          document.body.appendChild(resultsWrapper);

        } catch (err) {
          loading.remove();
          const fail = document.createElement('p');
          fail.textContent = "Failed to fetch gear.";
          fail.style.textAlign = 'center';
          fail.style.marginTop = '30px';
          fail.style.color = 'red';
          document.body.appendChild(fail);
          console.error("Error fetching gear:", err);
        }
      });
    });
  </script>
</body>
</html>
